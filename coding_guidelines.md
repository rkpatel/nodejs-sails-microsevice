# **Sails JS **

## **CheatSheet**

---

**Installation**

```
sudo` `npm ``install` `sails -g
```

**Create a New Project**

```
sails new myNewProject
```

**Run Project**

```
npm run dev // nodemon app.js, sails lift
```

## **Swagger Api Docs**

---

**Create Swagger Folder**

```
mkdir swagger
touch swagger.json
```

**Installation**

```
npm install --save-dev sails-hook-swagger-generator
```

**Swagger Url** : BASE_URL/swagger-docs/

## Folder Structure

---

- **assets** - _This Folder is used for storing static assets to serve in restfull apis_

  - images
  - js
  - json

- **config** - _This is one of the important folders. Sails is designed to be flexible. It assumes some standard conventions, but it also allows the developer to change the way Sails configures the created app to fit the project's needs._ _This folder contains various files that will allow you to customize and configure your Sails app._ _The following is a list of configuration files present in the `config` folder:_
  - **env** - _This folder used for setting global environment in sails project_
  - **locales** - _This folder contains json files in various language code that is used as i18n configuration_
  - **blueprints.js**
  - **bootstrap.js**
  - **cronjobs.js** - This file is mainly useful for handle all cronjobs.
  - **custom.js**
  - **datastore.js** - _This file is mainly useful for configuring your development database, as well as any additional one-off databases used by individual models._
  - **globals.js**
  - **http.js** - _This file is for configuring the underlying HTTP server in Sails, as well as any HTTP middleware your app may need._
  - **i18n.js**
  - **local.js**
  - **log.js**
  - **model.js** -_Unless you override them, the properties contained in this file will be included in each of your models._ _Model names must start with a letter and contain only letters, numbers and underscores._
  - **policies.js** - _Policies are simply Express middleware functions which run before your controllers. You can apply one or more policies to a given controller, or protect just one of it's actions._
  - **routes,js** - _This file contains custom routes. Sails uses these routes to determine what to do each time it receives a request._
  - **security.js**
  - **session,js**
  - **sockets.js**
  - **views.js**
- **api** - _This folder contains main codebase logic of sails application_
  - **controllers** - _Application Controllers_
  - **models** - This folder contains database table stucture along with table relationship
  - **policies** - _It stores rules for application user access_ (Also denoted as middleware in express terminology)
  - **responses** - _Global function for responses format_
  - **services** - This folder contains adding some functions which can used global as a feature (For eg. Password encrypt and compare, JWT Service)
  - **validations** - This folder contains all the JOI validations schema for each api

## Naming Conventions

---

#### **File / Folder Naming Conventions**

- **models**

  - Model name should follow PascalCase, This will follow the same conventions as ClassNames in Object Oriented Programming languages.
  - As per sails rules for naming conventions for Models. It must start with a letter and can contain only letters, numbers and underscores. Special Charactes not allowed in Model names.
  - Note : Should not contain "model" word in file name

- **responses**

  - responses Files name should follow camelCase. This will follow the same conventions as functions name in Object Oriented Programming languages.
  - Note : Should not contain "response" word in file name

- **controllers**

  - Crontrollers name should follow should follow PascalCase, and suffix "Controller" at the back. For eg, UserController, CompanyController

- **policies**

  - polices Files name should follow camelCase. This will follow the same conventions as functions name in Object Oriented Programming languages.
  - Note : Should not contain "policy/policies" word in file name

- **services**

  - services Files name should follow camelCase. This will follow the same conventions as functions name in Object Oriented Programming languages.
  - Note : Should not contain "service/services" word in file name

- **validations**

  - Validations Schema name should follow PascalCase, and suffix "Validation" at the back. For eg, UserValidation, CompanyValidation

- **assets and config**

  - assets folder contains all folders and files in lower case letters

  - config is folder generated by create-sails-app itself, no one should change file names or setting.

#### **Variable Naming Conventions**

- Variable and function names written as **camelCase** _(This can contain letters, numbers. Note - Undescore are not allowed)_

- Global variables written in **UPPERCASE**. _(This can contain letters, numbers and underscore)_

- Constants (like PI) written in **UPPERCASE** _(This can contain letters, numbers and underscore)_

- Databse column names should contain **lowercase** can contains underscore as well. Database name should not contains number and upper case letters or any other special characters.

#### **Function Naming Conventions**

This Project will follow functions names as camelCase "**camelCase**". \*This will follow the same conventions as functions name in Object Oriented Programming languages.

_Few commonly used function names are listed below_

```javascript
module.exports = {
  login: (req, res, next) => {},
  signup: (req, res, next) => {},
  create: (req, res, next) => {}, // For creating a record
  find: (req, res, next) => {}, // For getting multiple records
  findById: (req, res, next) => {}, // For getting single record by providing ID
  delete: (req, res, next) => {}, // For deleting multiple records at once
  deleteById: (req, res, next) => {}, // For deleting single record by providing ID
  updateById: (req, res, next) => {}, // For updating single record by providing ID

  // X - Below Methods will not allowed
  findUserById: (req, res, next) => {},
  getUsers: (req, res, next) => {},
  list: (req, res, next) => {},
  listById: (req, res, next) => {},
  findOne: (req, res, next) => {},
  deleteOne: (req, res, next) => {},
  updateOne: (req, res, next) => {},
};
```

## Coding Standards

---

### Variable Declarations

For Declaring variable in javscript we have var, let and const. Usage of var will not allowed in sails app as the code structure that has been followed is module bases. **_Only let and const variable will allowed_**

### Functions

All the functions created in sails application should follow Arrow Functions methodology

_Functions are first class citizens in Node's JavaScript, similar to the browser's JavaScript. A function can have attributes and properties also. It can be treated like a class in JavaScript._

**Note :** **_Waterline Functions created inside model folder, arrow function will not be supported in those file. function keyword will be used at that point_**

```javascript
find: async (req, res) => {
  try {
    const apps = await Application.find()
    .populate('job')
    .populate('candidate');
    return res.ok(apps);
  } catch (err) {
    return res.serverError(err);
  }
},
```

```javascript
module.exports = (req, res, next) => {
  if (req.user && req.user.role === "admin") {
    return next();
  } else {
    return res.badRequest({ err: "Valid access required" });
  }
};
```

### Asynchronous Code

There are various methods in javascript for doing async code like promises, async await, callback.

This sails project will use async await format for all database calls and whereever its possible. There are some exceptions using thirdparty library which not supports async await, at that time one can go for promises or callback but async await will be in first priority while reviewing.

```javascript
delete: async (req, res) => {
  try {
    const deleteApplication = await Application.destroy({ id: req.params.id });
    return res.ok(deleteApplication);
  } catch (err) {
    return res.serverError(err);
  }
}
```

#### Console Logs

For Logging in Javascript code , console.log is the way for logging in node js. In sails js application sails.log.error(), sails.log.warn() and other methods for logging.

```javascript
sails.log.info("I am an info-level message.");
sails.log("I am a debug-level message");
sails.log.warn("I am a warn-level message");
```

**Note: Global Configuration for showing console and console level can be configured in config/log.js file**

#### Comments

**File level Comments**

```javascript
/***************************************************************************

  APPLICATION CONTROLLER

  create : For creating new Job Application record
  find   : Getting all Job Application of the user or company
  delete : For Deleting Application record
***************************************************************************/
```

**Config level Comments**

```javascript
module.exports.blueprints = {
  /***************************************************************************
   *                                                                          *
   * Automatically expose implicit routes for every action in your app?       *
   *                                                                          *
   ***************************************************************************/
  // actions: false,
  /***************************************************************************
   *                                                                          *
   * Automatically expose RESTful routes for your models?                     *
   *                                                                          *
   ***************************************************************************/
  // rest: true,
  /***************************************************************************
   *                                                                          *
   * Automatically expose CRUD "shortcut" routes to GET requests?             *
   * (These are enabled by default in development only.)                      *
   *                                                                          *
   ***************************************************************************/
  // shortcuts: true,
};
```

**Function level Comments**

```javascript
/**
 * This controller function will called when user request for all the application
 * records related to the candidate or comapny requesting
 *
 * NOTE : Here we can specifying something important regarding this controller func.
 */
find: (req, res, next) => {};
```

**Line level Comments**

```javascript
find: (req, res, next) => {
  try {
    // Populating Job and Candidate data along with Application record
    const apps = await Application.find().populate("job").populate("candidate");
    // res.ok(apps);  X - Code level comments are not allowed unless its necessary
    return res.ok(apps);
  } catch (err) {
    // sails.log.error(err); X - Code level comments are not allowed unless its necessary
    return res.serverError(err);
  }
};
```

## Linting

---

#### Setup Autofix and AutoFormat on Save on Vscode

Open settings.json file of vscode, add below key value pairs . Also along with that enable Eslint plugin in your vscode.

```javascript
{
    "typescript.updateImportsOnFileMove.enabled": "always",
    "editor.formatOnSave": true,
    "javascript.format.enable": false,
    "eslint.autoFixOnSave": true,
    "editor.codeActionsOnSave": {
        "source.fixAll": true
    },
    "eslint.validate": [
        "javascript"
    ],
    "javascript.updateImportsOnFileMove.enabled": "always",
    "[javascript]": {
        "editor.defaultFormatter": "vscode.typescript-language-features"
    },
    "workbench.iconTheme": "material-icon-theme",
    // "files.eol": "\n"
}
```

**Note:** one can run `npm run lint` command for test linting
